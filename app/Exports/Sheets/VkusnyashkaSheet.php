<?php
namespace App\Exports\Sheets;

use App\Article;
use App\Lead;
use App\Models\System\RollHouse\AuthCustomuser;
use App\Models\System\RollHouse\Check;
use Maatwebsite\Excel\Concerns\Exportable;
use Maatwebsite\Excel\Concerns\FromCollection;
use Maatwebsite\Excel\Concerns\ShouldAutoSize;
use Maatwebsite\Excel\Concerns\WithTitle;
use Maatwebsite\Excel\Concerns\WithHeadings;

class VkusnyashkaSheet implements FromCollection, ShouldAutoSize
{

    use Exportable;

    /**
     * @return Builder
     */
    public function collection()
    {

        $groupedLeads = Lead::with([
            'main_phones'
        ])
            ->whereDate('created_at', '>=', '2020-09-01')
            ->whereDate('created_at', '<=', '2020-12-31')
            ->whereIn('stage_id', [2, 6, 10, 12, 15, 16])
            ->where('draft', false)
            ->whereNull('shipment_at')
            ->get()
            ->groupBy('main_phone.phone')
        ;
//        dd($groupedLeads);

        $array = [
            89247133336,
            88888888888,
            89086464700,
            89642789005,
            89027656060,
            89041147584,
            89834019613,
            89500510391,
            89646547950,
            89500984839,
            89025121888,
            89041441751,
            89149224591,
            89021707850,
            89025497760,
            89041245644,
            89149295979,
            89025604551,
            89041218691,
            89246333975,
            89641169858,
            89143070108,
            89501290075,
            89086471999,
            89086445064,
            89148801540,
            89647497283,
            89245454243,
            89087774615,
            89501373663,
            89646598460,
            89086661231,
            83952475775,
            83952432053,
            83952488541,
            89086698401,
            89027634106,
            89503802466,
            89248380660,
            83952920042,
            89148764795,
            89148890000,
            89246327197,
            89501253014,
            89501128239,
            89500607306,
            89041132727,
            89645464975,
            89086685625,
            89642237273,
            89500519680,
            89148868404,
            89027611194,
            89025428024,
            89501106776,
            89140135475,
            89149066138,
            89500908347,
            89832473937,
            89246028202,
            89501005989,
            89021718875,
            89500553629,
            89041181645,
            89041233740,
            89242947920,
            89025697750,
            89247012787,
            89149260026,
            89149252444,
            89086530304,
            89149021900,
            89025115188,
            89149440928,
            89246023029,
            89025786374,
            89025140140,
            89027666695,
            89246078050,
            89641162569,
            89027672733,
            89149175021,
            89021772755,
            89836979028,
            89500604648,
            89526153360,
            89041543924,
            89149099900,
            89643575597,
            89246258815,
            89148942910,
            89645445444,
            89246010003,
            89149446329,
            83952546399,
            89021776217,
            83952480902,
            89148955045,
            89027670863,
            89501323586,
            83952500562,
            89086686963,
            89027659612,
            89025127862,
            83952240512,
            89246212346,
            83952924411,
            89526304590,
            89642626162,
            89836958876,
            89027627254,
            89041512679,
            89027671952,
            89842761983,
            89246041141,
            89027676263,
            89500507363,
            89025441336,
            89501193652,
            89025135693,
            89041111932,
            89041447690,
            89148734161,
            89086635771,
            89086441977,
            89996860616,
            89025616305,
            89021778829,
            89642111110,
            89086444032,
            89501487340,
            89086408275,
            89501128881,
            89526248407,
            89246390295,
            89500512644,
            89501252970,
            89021763714,
            89647414051,
            89027637148,
            89834490304,
            89248388406,
            89501269538,
            89501106550,
            89646519991,
            89247074888,
            89021747250,
            89501460600,
            89646527584,
            89501295053,
            89247110904,
            89148969730,
            89086467065,
            89246001231,
            89842733170,
            83952403310,
            89500705810,
            89246280088,
            89086408357,
            89021750386,
            89834629830,
            89025697979,
            89086636623,
            89501020322,
            89526202282,
            89501137316,
            89086463794,
            89247059086,
            89041391339,
            89027659081,
            89500623276,
            89501275337,
            89086606924,
            89836986477,
            89041516667,
            89832427888,
            89501001006,
            89836945240,
            89021775367,
            89641037440,
            89842727559,
            89500515136,
            89149508842,
            89086412721,
            89501259600,
            89834034264,
            89149480312,
            89501400059,
            89021787293,
            89041134052,
            89500515150,
            89501327925,
            89501404639,
            89025772379,
            89021772928,
            89500533377,
            89025195378,
            89041126817,
            89501128037,
            89500892172,
            89148747530,
            89149559531,
            89041528789,
            89027611077,
            89500533134,
            89994204621,
            89041200900,
            89016641417,
            89086612317,
            89996420654,
            89149222966,
            89148839937,
            89501254562,
            89041515528,
            89021713215,
            89646534200,
            89025446318,
            89500937044,
            89140036000,
            89526296154,
            89086501540,
            89641293211,
            89086566271,
            89646505903,
            89500806600,
            89086639146,
            89526363603,
            89501157457,
            89149349801,
            89027615104,
            89501104856,
            89140075071,
            89149061718,
            89086698896,
            89021706011,
            89500873839,
            89086437656,
            89642668781,
            89148806554,
            89021762853,
            89149421610,
            89149452436,
            89041424171,
            89025111973,
            89648159008,
            89526245169,
            89021711269,
            89086612973,
            89501374549,
            89834660063,
            89086699266,
            89501011693,
            89643578457,
            89025144947,
            89501273834,
            89041501014,
            89501410725,
            89027617926,
            89025460018,
            89246086506,
            89086622513,
            89501254568,
            89149549542,
            89246028805,
            89641003132,
            89245312316,
            89149302249,
            89526298467,
            89834422332,
            89149543004,
            89246271219,
            89149279780,
            89025613246,
            89832454225,
            89500505111,
            89027617832,
            89834436505,
            89645489714,
            89999999999,
            89025161883,
            89041101111,
            89526242489,
            89027618655,
            89149009139,
            89025768653,
            89025104808,
            89025449693,
            89025688090,
            89501195662,
            89021763579,
            89148919161,
            89021716615,
            89646557297,
            89526184404,
            89041321763,
            89041423823,
            89148842706,
            89041460944,
            89501486575,
            89016524745,
            89041212654,
            89140026151,
            89247176694,
            89041171750,
            89641174975,
            89500508496,
            89149211718,
            89025468833,
            89041301273,
            89025680632,
            89501117728,
            89027647103,
            89086474688,
            89642659456,
            89500867961,
            89834037122,
            89025134243,
            89148934115,
            83952488700,
            89501372555,
            89500811040,
            89027624225,
            89501288257,
            89642110007,
            89245339958,
            89501077788,
            89041502259,
            89140072596,
            89642211499,
            89086655379,
            89086414802,
            89500897056,
            89246370407,
            89025662996,
            89086589590,
            89148768415,
            89021715575,
            89025195270,
            89246003716,
            89642101146,
            89242927656,
            89647490639,
            83952689525,
            89025699805,
            89086455645,
            89148725880,
            89025776846,
            89842758754,
            89501016059,
            89500977818,
            89086617837,
            89500796529,
            89647557727,
            89834481470,
            89016686101,
            89643521921,
            89501300227,
            89834056768,
            89041505107,
            89025102597,
            89834403551,
            89500703015,
            89086611050,
            89021756868,
            89021760924,
            89149473845,
            89086603414,
            89027627265,
            89501401180,
            89021711479,
            89500962880,
            89041588616,
            89025646968,
            89501026568,
            89025420404,
            89027682397,
            89021767712,
            89501462451,
            89501119113,
            89501463140,
            89025435647,
            89501338661,
            89021742669,
            89246083928,
            89501371698,
            89500516916,
            89087764677,
            89086477499,
            89041151766,
            89500978897,
            89149307442,
            89025786848,
            89027649291,
            89247074770,
            89086568508,
            89643572736,
            89086610848,
            89041599112,
            89025160046,
            89642758890,
            89646542636,
            89041493995,
            89041119495,
            89041374221,
            89140054441,
            89146392731,
            89025663202,
            89294355355,
            89025115524,
            89501118889,
        ];

        $phones = [];
        foreach($groupedLeads as $phone => $leads) {
            $res = array_search($phone, $array);
            if (!$res) {
                $phones[] = collect($phone);
            }
//            $phones[] = collect($phone);
//            dd($phones);
        }

        dd($groupedLeads->count(), count($phones));

        return collect($phones);
    }
}
